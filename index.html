<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Ghaith Tv</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <!-- hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    /* جعل الفيديو يتكيف مع الحاوية */
    .video-js {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Main Container -->
  <div class="flex flex-col items-center min-h-screen">
    <!-- Logo Section -->
    <div class="flex items-center justify-center h-1/3 w-full">
      <div class="text-center">
        <h1 class="text-6xl font-bold">
          Ghaith<span class="text-white bg-gray-900 px-2">Tv</span>
        </h1>
      </div>
    </div>
    <!-- Menu Section -->
    <div class="w-full px-4">
      <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
        <div class="flex justify-center items-center mb-4">
          <h2 class="text-xl font-bold">Ghaith Tv</h2>
        </div>
        <!-- Channel buttons will be added dynamically -->
        <div id="menuContainer" class="space-y-4"></div>
      </div>
    </div>
  </div>

  <!-- Video Player Modal -->
  <div id="videoPlayerModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-4 w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2">
      <div class="flex justify-between items-center mb-4">
        <h2 id="channelName" class="text-xl font-bold text-gray-900"></h2>
        <button onclick="closeVideoPlayer()" class="text-gray-900 text-2xl">&times;</button>
      </div>
      <div class="mb-4">
        <img id="channelLogo" class="mx-auto mb-2" height="100" width="100" alt="Channel Logo"/>
      </div>
      <!-- Video.js player مع إعدادات HLS -->
      <video-js id="videoPlayer" class="video-js vjs-fluid vjs-big-play-centered" controls preload="auto">
        <source id="videoSource" src="" type="application/x-mpegURL">
        Your browser does not support the video tag.
      </video-js>
    </div>
  </div>

  <!-- Video.js library + HLS integration -->
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
  <script>
    let player;
    let hls;

    // تهيئة المشغل مع دعم HLS
    function initPlayer(url) {
      if (videojs.getPlayer('videoPlayer')) {
        player.dispose();
      }
      
      player = videojs('videoPlayer', {
        techOrder: ['html5', 'hls'],
        hls: {
          withCredentials: false
        },
        controls: true,
        autoplay: true,
        fluid: true
      });

      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(player.tech().el());
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          player.play();
        });
      } else if (player.tech().el().canPlayType('application/vnd.apple.mpegurl')) {
        player.src(url);
        player.play();
      }
    }

    // فتح المشغل مع إعدادات HLS
    function openVideoPlayer(channel, url, logo) {
      document.getElementById('channelName').innerText = channel;
      document.getElementById('channelLogo').src = logo;
      document.getElementById('videoPlayerModal').classList.remove('hidden');
      initPlayer(url);
    }

    // إغلاق المشغل
    function closeVideoPlayer() {
      document.getElementById('videoPlayerModal').classList.add('hidden');
      if (player) {
        player.pause();
        if (hls) {
          hls.destroy();
        }
      }
    }

    // جلب بيانات القنوات وعرضها
    fetch("https://raw.githubusercontent.com/ghaith-99/ghaith-99/refs/heads/main/mytv.json")
      .then(response => response.text())
      .then(text => {
        const jsonStart = text.indexOf('[');
        if (jsonStart === -1) {
          throw new Error("Could not find the start of the array");
        }
        let jsonString = text.substring(jsonStart);
        // إزالة التعليقات (المحتوى بين /* و */)
        jsonString = jsonString.replace(/\/\*[\s\S]*?\*\//g, '');
        const data = JSON.parse(jsonString);
        console.log(data);
        const menuContainer = document.getElementById('menuContainer');
        data.forEach(item => {
          const btn = document.createElement('button');
          btn.className = "w-full bg-white text-gray-900 font-bold py-2 rounded-lg";
          btn.innerText = item.channel;
          btn.onclick = () => {
            openVideoPlayer(item.channel, item.url, item.logo);
          };
          menuContainer.appendChild(btn);
        });
      })
      .catch(error => {
        console.error("Error fetching channel data:", error);
      });
  </script>
</body>
</html>
